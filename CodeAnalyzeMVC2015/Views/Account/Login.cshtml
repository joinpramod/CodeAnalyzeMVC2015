
@{
    ViewBag.Title = "Login";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<h2>Login</h2><br />

    <table width="100%">
        <tr>
            <td align="center">

                <table style="font-size:16px" width="80%">

                    <tr>
                        <td align="center">
                            <span style="width: 100%; font-weight: bold; font-family: Calibri; color: Red">@ViewBag.lblAck</span>
                        </td>
                    </tr>
                    <tr><td>&nbsp;</td></tr>
                        @using (Html.BeginForm("ProcessLogin", "Account"))
                        {
                    <tr>

                        <td style="padding-left:4%;" align="center">
                            EMail:    @Html.TextBox("txtEMailId", "", new { style = "border:groove;width:34%;border-width:1px" })
                        </td>
                    </tr>
                    <tr>

                        <td align="center">
                            Password:  @Html.Password("txtPassword", "", new { style = "border:groove;width:25%;border-width:1px" })
                            <input type="submit" value="Login" id="btnLogin" onclick="return ValidateLogin()" style="border:none;color:white;background-color:#4fa4d5" />
                        </td>
                    </tr>
                    }
                    <tr>
                        <td style="padding-left:56%;">
                        @Html.ActionLink("Forgot Password", "ForgotPassword", "Account", null, new {style="font-size:14px" })
                        </td>
                    </tr>
                    <tr><td>&nbsp;</td></tr>
                    <tr>
                        <td align="center">
                            <table width="100%">
                                <tr>
                                    <td align="center">
                                        <script>
                                            //UserProfileFB
                                            (function (d) {
                                                var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
                                                if (d.getElementById(id)) { return; }
                                                js = d.createElement('script'); js.id = id; js.async = true;
                                                js.src = "//connect.facebook.net/en_US/sdk.js";
                                                ref.parentNode.insertBefore(js, ref);
                                            }(document));
                                            // Init the SDK upon load
                                            window.fbAsyncInit = function () {
                                                FB.init({
                                                    appId: '848792638492356', // Write your own application id
                                                    channelUrl: '//' + window.location.hostname + '/channel', // Path to your Channel File
                                                    scope: 'email,id,name,gender,user_birthday',
                                                    status: false, // check login status
                                                    //cookie: false, // enable cookies to allow the server to access the session
                                                    version: 'v2.5',
                                                    xfbml: true  // parse XFBML
                                                });
                                                // listen for and handle auth.statusChange events
                                                FB.Event.subscribe('auth.statusChange', function (response) {
                                                    //  debugger;
                                                    if (response.authResponse) {
                                                        //  debugger;
                                                        // user has auth'd your app and is logged into Facebook
                                                        var uid = "http://graph.facebook.com/" + response.authResponse.userID + "/picture";
                                                        FB.api('/me', function (me) {
                                                            if (me.name) {
                                                                 //debugger;

                                                                var form = document.createElement("form");
                                                                form.setAttribute("method", "post");
                                                                form.setAttribute("action", "/account/viewuser");

                                                                var hfEMail = document.createElement("input");
                                                                hfEMail.setAttribute("type", "hidden");
                                                                hfEMail.setAttribute("name", me.email);
                                                                hfEMail.setAttribute("value", me.email);


                                                                var hfName = document.createElement("input");
                                                                hfName.setAttribute("type", "hidden");
                                                                hfName.setAttribute("name", me.name);
                                                                hfName.setAttribute("value", me.name);


                                                                var hfImageURL = document.createElement("input");
                                                                hfImageURL.setAttribute("type", "hidden");
                                                                hfImageURL.setAttribute("name", me.hfImageURL);
                                                                hfImageURL.setAttribute("value", me.hfImageURL);


                                                                var hfType = document.createElement("input");
                                                                hfType.setAttribute("type", "hidden");
                                                                hfType.setAttribute("name", "Facebook");
                                                                hfType.setAttribute("value", "Facebook");

                                                                form.appendChild(hfEMail);
                                                                form.appendChild(hfName);
                                                                form.appendChild(hfImageURL);
                                                                form.appendChild(hfType);

                                                                document.body.appendChild(form);
                                                                form.submit();

                                                            }
                                                        })
                                                    }
                                                });
                                            }

                                        </script>

                                        <fb:login-button size="large" scope="public_profile,email" onlogin="require('./log').info('onlogin callback')">
                                            Login with Facebook
                                        </fb:login-button>
                                      </td>
                                      <td align="center">
                                          <div id="my-signin2"></div>
                                          <script>
                                                function onSuccess(googleUser) {
                                                    debugger;
                                                    var profile = googleUser.getBasicProfile();
                                                    //console.log('ID: ' + profile.getId());
                                                    //console.log('Name: ' + profile.getName());
                                                    //console.log('Image URL: ' + profile.getImageUrl());
                                                    //console.log('Email: ' + profile.getEmail());

                                                    var form = document.createElement("form");
                                                    form.setAttribute("method", "post");
                                                    form.setAttribute("action", "/account/viewuser");

                                                    var hfEMail = document.createElement("input");
                                                    hfEMail.setAttribute("type", "hidden");
                                                    hfEMail.setAttribute("name", profile.getEmail());
                                                    hfEMail.setAttribute("value", profile.getEmail());


                                                    var hfName = document.createElement("input");
                                                    hfName.setAttribute("type", "hidden");
                                                    hfName.setAttribute("name", profile.getName());
                                                    hfName.setAttribute("value", profile.getName());


                                                    var hfImageURL = document.createElement("input");
                                                    hfImageURL.setAttribute("type", "hidden");
                                                    hfImageURL.setAttribute("name", profile.getImageUrl());
                                                    hfImageURL.setAttribute("value", profile.getImageUrl());


                                                    var hfType = document.createElement("input");
                                                    hfType.setAttribute("type", "hidden");
                                                    hfType.setAttribute("name", "Google");
                                                    hfType.setAttribute("value", "Google");

                                                    form.appendChild(hfEMail);
                                                    form.appendChild(hfName);
                                                    form.appendChild(hfImageURL);
                                                    form.appendChild(hfType);

                                                    document.body.appendChild(form);
                                                    form.submit();


                                                }

                                                function onFailure(error) {
                                                    alert("Sign in with Google failed. Please try again");
                                                }

                                                function renderButton() {
                                                    gapi.signin2.render('my-signin2', {
                                                        'scope': 'https://www.googleapis.com/auth/plus.login',
                                                        'width': 170,
                                                        'height': 30,
                                                        'longtitle': true,
                                                        'theme': 'dark',
                                                        'onsuccess': onSuccess,
                                                        'onfailure': onFailure
                                                    });
                                                }
                                          </script>  
                                    </td>

                                    <td align="center">
                             
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr><td>&nbsp;</td></tr>
                    <tr><td>&nbsp;</td></tr>
                </table>


            </td>
        </tr>
    </table>





